---
title: 为侧边栏增加自动隐藏
categories:
  - study
  - web
tags: hexo
date: 2016-05-29 23:26:59
---


原版中，侧边栏只会在进入文章时显示，但如果文章看完后返回顶部并不会隐藏。虽然从实际角度出发并无大碍，多数看完文章就X了，可就是看着不顺眼，强迫症犯了然后……一晚上没了 T.T


去官网文档并没有找到关于文件结构的相关说明，便从网页开始逆向，从 *ClassName 、ID*  等关键词搜寻本地文件内容。傻逼样的 Windows 是根据后缀来判断是否搜索文件内容， 虽然是用纯文本写的 *.swig* 直接被无视了。想用批处理来批量转换.TXT再用Windows搜素，此处浪费一小时～搜了个能搜索自定义文件名纯文本内容的软件几分钟解决…… 真爱生命，少造轮子 〒▽〒

<!--more-->

后面还有一堆坑，不想说了……

CSS JS 等源文件目录
> Hexo\themes\next\source

##### HTML 结构部分
主题的_config.yml参数和以下文件共同控制。
&gt; Hexo\themes\next\layout\_macro\sidebar.swig

>   sidebar:    display: hide  


##### 函数部分
这部分关联文件很多，主要是通过
&gt; Hexo\themes\next\source\js\src\post-details.js
这个文件中最后一段
```javascript
  if (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        NexT.utils.displaySidebar();        
      }
    }
```
如果主题文件中*sidebar*为 post 或者 always 则会在页面载入后触发一次* NexT.utils.displaySidebar()* ，这个函数在
&gt; Hexo\themes\next\source\js\src\utils.js
中有体现。
```javascript
NexT.utils = NexT.$u = {
*****
 displaySidebar: function () {
    if (!this.isDesktop() || this.isPisces()) {
      return;
    }
    $('.sidebar-toggle').trigger('click');
  },
*****
}
```
根据作者其他函数的书写习惯，顺藤摸瓜查找类似以下的函数
```javascript
 $('.sidebar-toggle').on('click',function(){});
```
但这个函数细节始终没有找到。埋下最大一个坑。
开始觉得只要主题中设置为 *.hide* 后，在 *post-details.js* 最后添加以下函数即可
```javascript
$(document).scroll(function () {
   if ($(document).scrollTop() > 200 && $("#sidebar").css("display") == "none") {
             NexT.utils.displaySidebar();
         }
     else if ($(document).scrollTop() <= 200 && $("#sidebar").css("display") == "block") {
             NexT.utils.displaySidebar();
     }
 });//结束
```
在最顶部测试
>(document).scrollTop()  <= 200
>**ture**

>$("#sidebar").css("display") == "none"
>**ture**

>($(document).scrollTop() <= 200 && $("#sidebar").css("display")
>**false**

尼玛坑爹啊！  (╯°Д°)╯︵ ┻━┻ 
主要是因为触发的是模拟点击函数，并非直接操作侧边栏的动画。因此会有两者同步运行所产生的各种闪跳等BUG…… 找不到点击函数的情况下只得不断缩小 *if* 范围，缩小 显示/隐藏 两者同时运行的概率，最后写成了这样的巨无霸
```javascript
 // 下滑动右侧显示，上滑动右侧隐藏
    $("#sidebar").css("display","none");
    var a = "1";
    $(document).scroll(function () {
     //if (($(document).scrollTop() > 300) && ($("#sidebar").css("display") == "none")) {
     if (($(document).scrollTop() > 200) && ($("#sidebar").css("display") == "none") && $(".back-to-top-on").length > 0) {
         if (a == "1") {
             NexT.utils.displaySidebar();
             a = "0";
         }//大于 显示
     }
     //else if (($(document).scrollTop() <= 10) && ($("#sidebar").css("display") == "block")) {
     else if (($(document).scrollTop() <= 200) && ($("#sidebar").css("display") == "block") && $(".back-to-top-on").length == 0) {
         {
             if (a == "0") {
                 NexT.utils.displaySidebar();
                 a = "1";
             } //小于 隐藏
         }
     }
 });//结束
```
我知道肯定能精简…… 搞不下去了～
等会如果上传到主站如果还有BUG..... 我特么会疯的……