(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fd0ed1ba"],{1:function(e,t){},1419:function(e,t,a){"use strict";a("f089")},"1cc3":function(e,t,a){"use strict";a("270c")},"1d88":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container",attrs:{id:"tvwall-preview"}},[a("el-card",{staticClass:"treeWrap",class:e.treeMode,attrs:{"body-style":{padding:0},shadow:"hover"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:"mini"==e.treeMode,expression:"treeMode=='mini'"}],staticClass:"miniTip",on:{click:function(t){e.treeMode="full"}}},[a("el-button",{staticClass:"zoomIn",attrs:{icon:"el-icon-plus",circle:"",size:"mini"}}),e._v(" "),a("span",[e._v("项目列表")])],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"full"==e.treeMode,expression:"treeMode=='full'"}]},[a("div",{staticClass:"top"},[a("div",{staticClass:"row"},[a("div",[a("el-button",{staticClass:"zoomIn",attrs:{icon:"el-icon-minus",circle:"",size:"mini"},on:{click:function(t){e.treeMode="mini"}}}),e._v(" "),a("span",[e._v("在线数据来源")])],1),e._v(" "),a("el-switch",{staticClass:"switch",attrs:{"active-text":"自平台","active-value":"myself","inactive-text":"海康威视","inactive-value":"hkvs",size:"mini","inactive-color":"#ff4949"},model:{value:e.treeSource,callback:function(t){e.treeSource=t},expression:"treeSource"}})],1),e._v(" "),a("el-card",{staticClass:"searchBox",attrs:{shadow:"hover"}},[a("el-input",{staticClass:"input",attrs:{placeholder:"请输入项目名称",clearable:"",size:"mini"},model:{value:e.searchKey,callback:function(t){e.searchKey="string"===typeof t?t.trim():t},expression:"searchKey"}}),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"选中上墙",placement:"top"}},[a("el-button",{staticClass:"btn view",attrs:{type:"primary",icon:"el-icon-upload",size:"mini",loading:e.loading.toWallByArr},on:{click:e.toWallByArr}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除已选",placement:"top"}},[a("el-button",{staticClass:"btn empty",attrs:{type:"danger",icon:"el-icon-delete-solid",size:"mini"},on:{click:e.emptyCameraList}})],1)],1)],1),e._v(" "),a("el-tree",{ref:"tree",staticClass:"tree",class:e.treeSource,attrs:{data:e.haveRegionProjects,"show-checkbox":"","node-key":"_id","expand-on-click-node":!1,"check-on-click-node":!0,"filter-node-method":e.filterNode,"auto-expand-parent":!1,accordion:!0,"expand-after-filter":"collapse",draggable:!0,"allow-drop":function(){return!1},"allow-drag":e.canDrag},on:{"node-drag-start":e.dragStartHandle},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,r=t.data;return a("div",{staticClass:"tree-node",class:e.nodeClass(r)},[r.check?[a("div",{staticClass:"left"},[a("img",{staticClass:"treeIcon",attrs:{src:e.mapCameraSvgSrc(n.data.cameraTypeName)}}),e._v(" "),a("span",[e._v(e._s(n.label))])]),e._v(" "),a("div",{staticClass:"right"},[a("div",{staticClass:"delay"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"left",enterable:!1}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                        "+e._s(r.cameraTypeName)+"\n                                        "),a("br"),e._v("\n                                        "+e._s(e._f("timeFmt")(r.check.lastTime))+"\n                                        "),a("br"),e._v("\n                                        "+e._s(r.check.code)+"\n                                        "),a("br"),e._v("\n                                        "+e._s(r.check.msg)+"\n                                        "),a("br"),e._v("\n                                        "+e._s(r.check.delay)+" ms\n                                    ")]),e._v(" "),a("span",[e._v(e._s(e._f("delayFmt")(r.check.delay)))])])],1)])]:[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"right",enterable:!1}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                "+e._s(r.branch)+"\n                                "),a("br"),e._v("\n                                "+e._s(r.fullName)+"\n                            ")]),e._v(" "),a("div",[a("svg",{staticClass:"iconfont",attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":"#icon-building-small"}})]),e._v("\n                                "+e._s(n.label)+"\n                            ")])]),e._v(" "),a("div",{staticClass:"right"},[r.des?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:r.des,placement:"top",enterable:!1}},[a("el-tag",{staticClass:"des",attrs:{type:"info",effect:"plain"}},[e._v(e._s(r.des))])],1):e._e(),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"hkvs"==e.treeSource,expression:"treeSource=='hkvs'"}]},[a("span",[e._v(e._s(r.region.camerasState.count_hkvs.online))]),e._v(" "),a("span",[e._v("/")]),e._v(" "),a("span",[e._v(e._s(r.region.camerasState.count_hkvs.total))])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"myself"==e.treeSource,expression:"treeSource=='myself'"}]},[a("span",[e._v(e._s(r.region.camerasState.count.online))]),e._v(" "),a("span",[e._v("/")]),e._v(" "),a("span",[e._v(e._s(r.region.camerasState.count.total))])])],1)]],2)}}])})],1)]),e._v(" "),a("el-card",{staticClass:"videoWrap",attrs:{"body-style":{padding:0},shadow:"hover"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.cycle||e.loading.pane,expression:"loading.cycle || loading.pane"}],staticClass:"tools"},[a("div",{staticClass:"state"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.cycleState.lastState,placement:"top"}},[[a("div",[e.cycleState.work?a("RelativeTime",{attrs:{time:e.cycleState.lastSuccTime,cycle:e.cycleState.cycleTime,work:e.cycleState.work}}):a("el-tag",{attrs:{type:"danger","disable-transitions":""}},[e._v("轮询已暂停")])],1)]],2)],1),e._v(" "),a("div",{staticClass:"btns"},[a("el-button",{attrs:{icon:"el-icon-d-arrow-left",plain:"",circle:""},on:{click:function(t){return e.ajaxTvWallControl("prev")}}}),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.cycleState.work,expression:"cycleState.work"}],attrs:{type:"danger",plain:"",icon:"el-icon-video-pause",size:"mini"},on:{click:function(t){return e.ajaxTvWallControl("pause")}}},[e._v("暂停")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.cycleState.work,expression:"!cycleState.work"}],attrs:{type:"success",plain:"",icon:"el-icon-video-play",size:"mini"},on:{click:function(t){return e.ajaxTvWallControl("start")}}},[e._v("开始")]),e._v(" "),a("el-button",{attrs:{icon:"el-icon-d-arrow-right",plain:"",circle:""},on:{click:function(t){return e.ajaxTvWallControl("next")}}}),e._v(" "),a("el-button",{attrs:{type:"success",plain:"",icon:"el-icon-refresh-right",circle:""},on:{click:function(t){return e.refreshCycleState()}}}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-setting",circle:""},on:{click:function(t){return e.openSetting()}}})],1)]),e._v(" "),a("el-divider",[a("i",{staticClass:"el-icon-video-camera"})]),e._v(" "),a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.pane,expression:"loading.pane"}],attrs:{type:"border-card",stretch:!0},model:{value:e.cycleTab,callback:function(t){e.cycleTab=t},expression:"cycleTab"}},[a("el-tab-pane",{attrs:{label:"上一轮",name:"prev",lazy:!0}},[a("Pane",{attrs:{list:e.cycleState.prevArr}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"当前",name:"curr",lazy:!0}},[a("Pane",{attrs:{list:e.cycleState.currArr,zoomIn:e.cycleState.zoomIn}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"下一轮",name:"next",lazy:!0}},[a("Pane",{attrs:{list:e.cycleState.nextArr}})],1)],1)],1),e._v(" "),a("Setting",{ref:"setting",attrs:{cycleState:e.cycleState}})],1)},r=[],c=(a("8e6e"),a("ac6a"),a("456d"),a("6762"),a("2fdb"),a("0d6d"),a("ade3")),s=a("2f62"),i=a("7cf8"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-tag",{attrs:{type:e.timeout?"danger":"","disable-transitions":""}},[e._v(e._s(e.timeout?"超时":"")+" "+e._s(e.relativeHm))])},l=[],u={name:"RelativeTime",mounted:function(){var e=this;this.relativeHm=this.calc(),this.timer=setInterval((function(){e.relativeHm=e.calc()}),1e3)},data:function(){return{timer:null,relative:"",relativeHm:""}},props:{time:{default:0,required:!0},cycle:{default:0}},computed:{timeout:function(){return this.relative<0}},methods:{calc:function(){var e=new Date(this.time),t=(this.nextCycle(e,this.cycle),parseInt((this.nextCycle(e,this.cycle)-Date.now())/1e3,10));this.relative=t;var a=Math.abs(t),n=parseInt(a/60),r=parseInt(a%60),c=n<10?"0"+n:n,s=r<10?"0"+r:r;return a<60?"00:".concat(s):a<3600?"".concat(c,":").concat(s):a<86400?"".concat(parseInt(a%3600),"h"):"".concat(parseInt(a%86400),"天")},nextCycle:function(e,t){var a=e.getTime(),n=a%t,r=a-n+t;while(r<Date.now())r+=t;return r+1}},beforeDestroy:function(){clearInterval(this.timer)}},d=u,f=a("2877"),p=Object(f["a"])(d,o,l,!1,null,"590f052e",null),v=p.exports,m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-drawer",{staticClass:"setting",attrs:{title:"预览设置",visible:e.drawer},on:{"update:visible":function(t){e.drawer=t}}},[a("div",{staticClass:"body"},[a("el-divider",[a("i",{staticClass:"el-icon-setting"})]),e._v(" "),a("el-form",{staticClass:"table",attrs:{"label-position":"left"}},[a("el-form-item",{attrs:{label:"轮询周期"}},[a("span",[e._v(e._s(e.cycleState.cycleTime/1e3)+"s")])]),e._v(" "),a("el-form-item",{attrs:{label:"当前全屏"}},[a("span",[e._v(e._s(e.cycleState.zoomIn||"null"))])])],1)],1)])},h=[],y={name:"",data:function(){return{drawer:!1}},props:{cycleState:{type:Object,defalut:{}}},methods:{open:function(){this.drawer=!0}}},g=y,b=(a("5413"),Object(f["a"])(g,m,h,!1,null,"7f2eee12",null)),w=b.exports,_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pane"},[a("Empty",{directives:[{name:"show",rawName:"v-show",value:0===e.list.length,expression:"list.length===0"}]}),e._v(" "),a("div",{staticClass:"videos"},e._l(e.list,(function(t,n){return a("CameraWrap",{key:n+"_"+t._id,style:{width:e.cameraWidth+"%"},attrs:{index:n,camera:t,autoplay:!1,full:n+1==e.zoomIn,project:t.project}})})),1)],1)},k=[],C=(a("c5f6"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"empty"},[e._v("暂无数据")])}),O=[],j=(a("cebc"),{}),x=Object(f["a"])(j,C,O,!1,null,"7c02f9df",null),S=x.exports,T=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"boxWrap",class:{full:e.full,drag:e.drag,drop:e.drop},attrs:{draggable:""},on:{dragstart:e.dragStartHandle,dragend:e.dragEndHandle,dragover:e.dragOverHandle,dragleave:function(t){return e.setDrag(!1)},drop:e.dropHandle}},[a("div",{staticClass:"cBtns"},[[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.full,expression:"!full"}],staticClass:"full",attrs:{type:"primary",icon:"el-icon-full-screen",circle:"",size:"mini"},on:{click:function(t){return e.tvWallFull(!0)}}}),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.full,expression:"full"}],staticClass:"minus",attrs:{type:"primary",icon:"el-icon-minus",circle:"",size:"mini"},on:{click:function(t){return e.tvWallFull(!1)}}})]],2),e._v(" "),a("div",{staticClass:"box camera"},[a("div",{staticClass:"scale"},[a("div",{staticClass:"item"},[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.autoplayControl,expression:"!autoplayControl"}],staticClass:"autoplay"},[a("el-button",{staticClass:"play",attrs:{icon:"el-icon-video-play",circle:""},on:{click:e.play}})],1),e._v(" "),a("Camera",{directives:[{name:"show",rawName:"v-show",value:e.autoplayControl,expression:"autoplayControl"}],ref:"camera",staticClass:"video",attrs:{camera:e.camera,project:e.project,autoplay:!1,controls:["toRefresh","toCheck"]}}),e._v(" "),a("div",{staticClass:"info"},[a("p",[e._v("\n                        "+e._s(e.index+1)+" "+e._s(e.project.shortName)+"-"+e._s(e.camera.cameraName)+"\n                        "+e._s(e._f("delayFmt")(e.camera.check.delay))+"\n                    ")])])],1)])])])},D=[],N=a("c0f46"),E=a("f3bd"),R={name:"",data:function(){return{drag:!1,drop:!1,manua:!1}},props:{index:{type:Number,required:!0},camera:{type:Object,required:!0},project:{type:Object,required:!0},autoplay:{type:Boolean,default:!0},full:{type:Boolean,default:!1}},computed:{autoplayControl:function(){return this.manua||this.autoplay}},methods:{play:function(){this.manua=!0,this.$refs.camera.init()},dragStartHandle:function(e){this.setDrop(!0),e.dataTransfer.effectAllowed="all";var t=JSON.stringify({source:"camera",from:this.index,camera:Object(N["ajaxCameraHandle"])(this.camera)});e.dataTransfer.setData("info",t)},dragEndHandle:function(e){this.setDrop(!1)},setDrop:function(e){this.drop=e},dragOverHandle:function(e){e.preventDefault(),this.setDrag(!0),e.dataTransfer.dropEffect="move"},dropHandle:function(e){var t=this;e.preventDefault();var a=e.dataTransfer.getData("info");a=JSON.parse(a);var n=a,r=n.source,c=n.from,s=n.camera;if("camera"!=r||c!=this.index){var o=new Array(15);switch(r){case"camera":o[c]=Object(N["ajaxCameraHandle"])(this.camera),o[this.index]=s;break;case"tree":o[this.index]=s;break}Object(i["b"])({cameras:o}).then((function(e){t.$message.success("上墙成功")})),this.setDrag(!1)}},setDrag:function(e){this.drag=e},tvWallFull:function(e){var t=this,a=e?i["l"]:i["m"];a(this.index+1).then((function(a){t.$message.success("".concat(e?"全屏":"缩小"," 成功"))})).catch((function(e){console.log("err",e)}))}},components:{Camera:E["a"]}},P=R,$=(a("1cc3"),Object(f["a"])(P,T,D,!1,null,"82f7d770",null)),z=$.exports;function H(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function I(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?H(Object(a),!0).forEach((function(t){Object(c["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):H(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var W={name:"",props:{list:{type:Array,default:function(){return[]}},zoomIn:{type:Number}},computed:I(I({},Object(s["b"])(["device"])),{},{cameraWidth:function(){return"desktop"==this.device?20:100}}),methods:{test:function(){console.log("22222",22222)}},components:{Empty:S,CameraWrap:z}},M=W,L=(a("1419"),Object(f["a"])(M,_,k,!1,null,"16430d56",null)),q=L.exports,A=a("8055"),B=a.n(A),F=a("f121"),U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=console.log,a=B()(F["a"]+"/monitor",{query:{room:"tvwall"},transports:["websocket"]});return a.on("connect",(function(){var n=a.id;t("#connect,",n,a),a.on(n,(function(a){t("#receive,",a),e(a)}))})),a.on("online",(function(e){t("#online,",e)})),a.on("cycleState",(function(t){console.log("#cycleState",t),e(t)})),a.on("disconnect",(function(e){t("#disconnect",e)})),a.on("disconnecting",(function(){t("#disconnecting")})),a.on("error",(function(e){t("#error",e)})),a};function K(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function J(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?K(Object(a),!0).forEach((function(t){Object(c["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):K(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var G={name:"tvwall-preview",mounted:function(){this.initWs()},data:function(){return{loading:{cycle:!1,pane:!1,toWallByArr:!1},treeSource:"hkvs",treeMode:"full",cycleTab:"curr",socket:null,searchKey:"",cycleState:{},cycleStateTimer:null}},watch:{searchKey:function(e){this.$refs.tree.filter(e)}},computed:J(J({},Object(s["b"])(["projects"])),{},{haveRegionProjects:function(){return this.projects.filter((function(e){return e.regionUuid})).map((function(e){var t=J({},e);return t.isLeaf=!1,t.label=t.shortName,t.disabled=0===t.region.cameras.length,t.children=t.region.cameras.map((function(t){var a=J({},t);return a.isLeaf=!0,a.label=t.cameraName,a.project=e,a})),t}))}}),methods:{mapCameraSvgSrc:function(e){return a("ec17")("./".concat(e,".svg"))},initWs:function(){this.socket=U(this.parseMsg)},parseMsg:function(e){var t=this;switch(e.action){case"cycleState":this.loading.pane=!0,this.cycleStateTimer&&clearTimeout(this.cycleStateTimer),setTimeout((function(){t.cycleState=Object.freeze(e.data),t.$nextTick((function(){t.loading.pane=!1}))}),200);break}},emptyCameraList:function(){this.$refs.tree.setCheckedNodes([])},ajaxTvWallControl:function(e){var t=this,a=null;switch(e){case"start":a=i["y"];break;case"pause":a=i["w"];break;case"prev":a=i["x"];break;case"next":a=i["v"];break}this.loading.cycle||(this.loading.cycle=!0,a().then((function(){t.$message.success("电视墙控制成功")})).catch((function(e){console.log("err.message",e.message)})).finally((function(){t.loading.cycle=!1})))},refreshCycleState:function(){this.socket.emit("getCycleState")},openSetting:function(){this.$refs.setting.open()},toWallByArr:function(){var e=this,t=this.$refs.tree.getCheckedNodes({leafOnly:!0});t=t.filter((function(t){return t.cameraUuid&&t.project&&(t.project.fullName.includes(e.searchKey)||t.project.shortName.includes(e.searchKey))})).slice(0,15),this.$message.info("过滤后已选择 ".concat(t.length," 个摄像头")),this.loading.toWallByArr||(this.loading.toWallByArr=!0,Object(i["b"])({cameras:Object(N["ajaxCameraHandle"])(t)}).then((function(t){e.$message.success("上墙成功")})).catch((function(e){console.log("err.message",e.message)})).finally((function(){e.loading.toWallByArr=!1})))},filterNode:function(e,t,a){if(!e)return!0;var n={};return n=1==a.level?t:a.parent.data,!(!n.fullName.includes(e)&&!n.shortName.includes(e))},nodeClass:function(e){var t="";return e.shortName?(t="project",e.region.camerasState.percent.offline>=100&&(t+=" offline "),e.region.camerasState.percent_hkvs.offline>=100&&(t+=" offline_hkvs ")):(t="camera",-1===e.check.delay&&(t+=" offline "),1!==e.onLineStatus&&(t+=" offline_hkvs ")),t},canDrag:function(e){return e.data.cameraUuid},dragStartHandle:function(e,t){this.cycleTab="curr",t.dataTransfer.effectAllowed="all";var a=JSON.stringify({source:"tree",camera:Object(N["ajaxCameraHandle"])(e.data)});t.dataTransfer.setData("info",a)},test:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"123";console.log("123",e)}},components:{Setting:w,RelativeTime:v,Pane:q},beforeDestroy:function(){this.socket.disconnect()}},Q=G,V=(a("7420"),Object(f["a"])(Q,n,r,!1,null,"40e0624a",null));t["default"]=V.exports},"270c":function(e,t,a){},"278e":function(e,t,a){e.exports=a.p+"static/img/带云镜枪机.55996319.svg"},4446:function(e,t,a){e.exports=a.p+"static/img/快球.d93ff7ad.svg"},5413:function(e,t,a){"use strict";a("6791")},"56ff":function(e,t,a){},6791:function(e,t,a){},7420:function(e,t,a){"use strict";a("56ff")},"9ad3":function(e,t,a){"use strict";a("e19b")},b8ea:function(e,t,a){e.exports=a.p+"static/img/枪机.55996319.svg"},bce0:function(e,t,a){},cebc:function(e,t,a){"use strict";a("bce0")},d363:function(e,t,a){e.exports=a.p+"static/img/半球.d93ff7ad.svg"},e19b:function(e,t,a){},ec17:function(e,t,a){var n={"./半球.svg":"d363","./带云镜枪机.svg":"278e","./快球.svg":"4446","./枪机.svg":"b8ea"};function r(e){var t=c(e);return a(t)}function c(e){var t=n[e];if(!(t+1)){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return t}r.keys=function(){return Object.keys(n)},r.resolve=c,e.exports=r,r.id="ec17"},f089:function(e,t,a){},f3bd:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"video",staticClass:"video"})},r=[],c=(a("6762"),a("2fdb"),a("96cf"),a("1da1")),s=a("c0f46"),i=(a("8e6e"),a("ac6a"),a("456d"),a("ade3")),o=(a("a481"),a("37b6")),l=a("7cf8");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var f="/img/hls/loading.gif";function p(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};console.log("camera",t);var r=t.cameraUuid,c=t.cameraName,s=t.check,i=void 0===s?{}:s,u=i.lastOnlineChannel,p=void 0===u?1:u,v=a.shortName,m=o["c"].replace("{cdn}",r.substring(0,5)).replace("{cameraUuid}",r).replace("{channel}",p),h=Object.assign({container:e,video:{url:m,pic:f},volume:0,live:!0,autoplay:!0,mutex:!1,pluginOptions:{hls:{manifestLoadingTimeOut:6e4,manifestLoadingMaxRetry:3,fragLoadingTimeOut:2e3,fragLoadingMaxRetry:5,fragLoadingRetryDelay:10}},controls:{volume:!1,play:!1,live:!1}},n),y=new DPlayer(h);return y._isDestroy=!1,y.on("error",(function(e){console.log("dplayer err",e)})),y.on("canplay",(function(){console.log("canplay",123),t.check.delay>0||Object(l["c"])(r).then((function(e){t.check=d({},e.result.check)})).catch((function(e){console.log("err",e)})).finally((function(){}))})),y.on("play",(function(){console.log("play",123)})),y.on("waiting",(function(){console.log("waiting",123)})),y.on("destroy",(function(){y._isDestroy=!0})),y.plugins.hls&&y.plugins.hls.on(Hls.Events.ERROR,(function(e,t){if(console.log(e,t.fatal,t.type,v,c,r,t),!y._isDestroy&&t.fatal)switch(t.type){case Hls.ErrorTypes.MEDIA_ERROR:y.plugins.hls.recoverMediaError();break;case Hls.ErrorTypes.NETWORK_ERROR:y.plugins.hls.startLoad();break;default:console.log("hls default error",t.type);break}})),console.log("dp",y,y.type,y.plugins),y}var v=p,m='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32">\n    <path d="M16 23c-3.309 0-6-2.691-6-6s2.691-6 6-6 6 2.691 6 6-2.691 6-6 6zM16 13c-2.206 0-4 1.794-4 4s1.794 4 4 4c2.206 0 4-1.794 4-4s-1.794-4-4-4zM27 28h-22c-1.654 0-3-1.346-3-3v-16c0-1.654 1.346-3 3-3h3c0.552 0 1 0.448 1 1s-0.448 1-1 1h-3c-0.551 0-1 0.449-1 1v16c0 0.552 0.449 1 1 1h22c0.552 0 1-0.448 1-1v-16c0-0.551-0.448-1-1-1h-11c-0.552 0-1-0.448-1-1s0.448-1 1-1h11c1.654 0 3 1.346 3 3v16c0 1.654-1.346 3-3 3zM24 10.5c0 0.828 0.672 1.5 1.5 1.5s1.5-0.672 1.5-1.5c0-0.828-0.672-1.5-1.5-1.5s-1.5 0.672-1.5 1.5zM15 4c0 0.552-0.448 1-1 1h-4c-0.552 0-1-0.448-1-1v0c0-0.552 0.448-1 1-1h4c0.552 0 1 0.448 1 1v0z"></path>\n</svg>',h={name:"",mounted:function(){this.camera&&this.camera._id&&this.autoplay&&this.init()},data:function(){return{isInit:!1,loading:{toCheck:!1},dp:null,msg:null}},props:{camera:{type:Object,required:!0},project:{type:Object,required:!0},autoplay:{type:Boolean,default:!0},controls:{type:Array,default:function(){return["toRefresh","toTv","toCheck"]}}},watch:{"loading.toCheck":function(){var e=this.dp.container.querySelector(".dplayer-icons-right"),t=e.querySelector(".toCheck");t&&(this.loading.toCheck?t.classList.add("loading"):t.classList.remove("loading"))}},methods:{init:function(){var e=this;console.log("init"),this.isInit||(this.isInit=!0,this.dp=v(this.$refs.video,this.camera,this.project,{initFinish:this.addBtn,contextmenu:[{text:"重新载入",click:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(a){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.videoRefresh();case 2:case"end":return t.stop()}}),t)})));function a(e){return t.apply(this,arguments)}return a}()}]}),this.dp.on("destroy",(function(){var t=e.dp.container.querySelector(".dplayer-icons-right");t&&(t.querySelector(".toRefresh")&&t.querySelector(".toRefresh").removeEventListener("click",e.videoRefresh),t.querySelector(".toTv")&&t.querySelector(".toTv").removeEventListener("click",e.toTv),t.querySelector(".toCheck")&&t.querySelector(".toCheck").removeEventListener("click",e.toCheck))})))},addBtn:function(){var e=this.$refs.video.querySelector(".dplayer-icons-left");this.controls.includes("toRefresh")&&(e.insertAdjacentHTML("afterbegin",'<div class="diy toRefresh" data-balloon="刷新" data-balloon-pos="up">\n                    <i class="icon el-icon-refresh-right"></i>\n                </div>'),e.querySelector(".toRefresh").addEventListener("click",this.videoRefresh));var t=this.$refs.video.querySelector(".dplayer-icons-right");this.controls.includes("toTv")&&(t.insertAdjacentHTML("afterbegin",'<div class="diy toTv" data-balloon="上墙" data-balloon-pos="up">\n                    <button class="dplayer-icon">上墙</button></div>\n                </div>'),t.querySelector(".toTv").addEventListener("click",this.toTv)),this.controls.includes("toCheck")&&(t.insertAdjacentHTML("afterbegin",'<div class="dplayer-icon toCheck" data-balloon="整改通知单" data-balloon-pos="up">\n                    <span class="dplayer-icon-content">'.concat(m,"</span>\n                </div>")),t.querySelector(".toCheck").addEventListener("click",this.toCheck))},toTv:function(){var e=this;Object(l["a"])({wId:1,camera:Object(s["ajaxCameraHandle"])(this.camera)}).then((function(t){e.$message.success("上墙成功")})).catch((function(e){console.log("err",e)}))},toCheck:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,!this.loading.toCheck){e.next=3;break}return e.abrupt("return");case 3:return this.loading.toCheck=!0,e.next=6,Object(s["videoToImgs"])(this.dp.video);case 6:return t=e.sent,e.next=9,this.ajaxUploadImg(t);case 9:e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](0),console.log("error",e.t0),this.$message.error("获取图片错误 ".concat(e.t0.message));case 15:return e.prev=15,this.loading.toCheck=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[0,11,15,18]])})));function t(){return e.apply(this,arguments)}return t}(),ajaxUploadImg:function(e){var t=this;return new Promise((function(a,n){var r=e.blob;if(!r)return t.$message.error("获取图片失败"),void a();var c=t.camera,i=c.cameraUuid,o=c.cameraName,u=t.project,d=u._id,f=u.shortName,p="".concat(f,"_").concat(o,"_").concat(Date.now()),v=new window.FormData;v.append("file",r,"".concat(p,".png")),t.msg=t.$message({showClose:!0,message:"图片上传中 ".concat(p),duration:0}),Object(l["z"])(d,v).then((function(e){t.$message({type:"success",message:"图片上传成功 ".concat(p)}),t.$store.state.monitor.checkForm.openForm({pId:d,cId:i,imgs:[e.result]})})).catch((function(e){t.$message({type:"error",message:"图片上传失败 已下载到本地 ".concat(e.message," ").concat(p)}),Object(s["blobToDownload"])(r,p)})).finally((function(){t.msg&&t.msg.close(),a()}))}))},videoRefresh:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.videoDestroy(),e.next=3,Object(s["sleep"])(100);case 3:this.init();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),videoDestroy:function(){this.dp&&this.dp.destroy()}},beforeDestroy:function(){this.videoDestroy()}},y=h,g=(a("9ad3"),a("2877")),b=Object(g["a"])(y,n,r,!1,null,"55bf0b8c",null);t["a"]=b.exports}}]);